## msa 워크샵 참석 1주차

회사에서 진행한 워크샵은 아니고 자기 주체적인 워크샵 ㅋㅋ<br/>

패캠에서 진행하는 msa 오프라인 교육인데, 워크샵이라는 이름으로 열린 교육에 참석했다.<br/>

강의의 정가는 90만원이다.<br/>

나는 할인을 받아서 사비로 구매해서 참석을 했는데 구체적인 비용은 밝힐수 없다.<br/>

<br/>



강사님이 스타트업 경험을 해보면서 경험한 MSA 전환사례 등을 이야기를 많이 해주셨고, MSA를 팔고 다니는 분들을 경계하라는 이야기도 해주셔서 MSA에 대해 신중한 접근을 해야겠다는 시각도 심어주셨고, 어떤 시기에 MSA를 도입하게 되는지, 지나치게 MSA를 적용해서 힘들어지는 사례, 어드민 시스템을 MSA로 분리해도 되는지에 대한 실제 현업에서의 사례 등을 모두 설명해주셨다.<br/>



사실 이번 강의를 해주신 강사님은 온라인 강의로 거의 다 강의를 완주했었다. 마지막 SNS 프로젝트 강의빼고는 거의 다 들었었다. 그 당시에 Kubernetes 백엔드 개발 강의였었다.<br/>

이번에도 들었는데 정말 마음에 드는 강의다. 후 <br/>



이번 msa 워크샵 1주차 마지막 날인 일요일. 오늘 들은 내용 중 가장 인상깊었던 내용은 트랜잭션이다. 분산트랜잭션으로 넘어갈 때 겪는 현상들과 보상트랜잭션, API 오케스트레이션을 사용하게 되는 과도기적 상황들, SAGA에 이르기까지 설명해주셨다.<br/>

결과적으로는 Transaction 의 ACID 를 모두 따르기보다는 어느 정도 규모가 커져서 데이터베이스의 처리량을 보장할 수 없다면 BASE 로 넘어가야 한다는 큰 힌트를 남겨주셨다.<br/>

이번 주 강의는 강의 시간이 꽤 꽉꽉 채웠음에도 시간이 살짝 부족해서 분산 트랜잭션을 모두 다 듣지 못했다. 다음주에 MSA에서의 트랜잭션에 대해 남은 부분을 듣게 되고 다음주에는 드디어 기다리고 기다리던 MSA 모니터링, 보안에 대한 내용이다. Gateway 적용시 실제 보안적으로 필요한 내용들 등을 들을 수 있을 것 같다.<br/>



오늘 집에오면서 이번 강의를 들으면서 계속 생각난 주제가 있다.<br/>

'포인트 충전/지급/합산/차감 관련 기능에 대해서 부하를 줄일수 있는 방법'에 대한 주제다.<br/>

최근 2주간 어떤 분을 새롭게 본적이 있는데 이 분은 옛날 SI 식으로 `기냥 서브쿼리 써서 서버 막 쓰면 되요` 이런 식이다.<br/>

솔직히 좀 가끔 이런 분들 짜증난다. 가끔 이런 분한테는 `그렇게 모든 게 입만 털면 될 정도로 쉬우면 님은 밥은 왜먹고 똥은 왜 싸세요?` 하고 물어보고 싶을 때가  너무나 많다.<br/>

누가 이 분을 좋게 봐서 강력하게 원한건지 이해가 안 될 때가 너무 많다.<br/>

<br/>



포인트 충전은 어느 시스템이든 운영 업력이 5년 이상을 넘어가면 부하가 생긴다.<br/>

그런데 카카오 페이지의 포인트 지급, 충전과 포인트 사용은 항상 부하가 없다. 이게 항상 나는 궁금했다.<br/>

나는 이게 정말 정말 정말!!! 로 항상 궁금했었고...  최근에 한번 예제 플젝을 돌려볼까 생각중이고 대략적인 생각은 이렇다.

- 포인트 충전/지급/사용 요청에 대한 요청 id 를 고유키로 생성한다.
  - e.g. `{사용자 id}{timestamp}{요청기기type(번호)}` 
- 들어오는 요청 id 와 요청에 대한 연산 타입, payload 데이터 등을 `point_create_request` 테이블에 insert 한다.
- 결과값을 돌려받지 않아도 되는 비동기 통신으로 insert 요청을 수행할 수도 있겠지만, 일단 예제 시나리오에서는 동기 방식의 통신으로 한다.
- 포인트 합산도 전날, 전월 합산을 미리 해둔 테이블에서 합산을 수행하는 방식을 생각 중이다. 아직 구체적인 아이디어는 계속 생각 중이다.
- 전날, 전월 합산은 별도의 배치에서 돌리며, 배치가 수행되는 시점의 경계를 00:00 \~ 23:30 으로 해두는 식으로 할지도 경우의 수를 따져보고 있다.

<br/>







